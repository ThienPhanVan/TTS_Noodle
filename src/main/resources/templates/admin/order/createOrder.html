<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">

<head>
    <th:block th:replace="/layout/script/head :: head"></th:block>
</head>

<body>

<div class="wrapper">
    <!-- Sidebar  -->
    <div class="iq-sidebar">
        <div class="iq-navbar-logo d-flex justify-content-between">
            <a href="/home" class="header-logo">
                <!-- <img src="assets/images/logo.png" class="img-fluid rounded" alt=""> -->
                <img src="/assets/images/nudo.jpg" alt="">
                <span>Bún Việt</span>
            </a>
            <div class="iq-menu-bt align-self-center">
                <div class="wrapper-menu">
                    <div class="main-circle"><i class="ri-menu-line"></i></div>
                    <div class="hover-circle"><i class="ri-close-fill"></i></div>
                </div>
            </div>
        </div>
        <div id="sidebar-scrollbar">
            <nav class="iq-sidebar-menu">
                <ul id="iq-sidebar-toggle" class="iq-menu">
                    <li class="active">
                        <a href="#dashboard" class="iq-waves-effect" data-toggle="collapse" aria-expanded="true"><span
                                class="ripple rippleEffect"></span><i
                                class="las la-home iq-arrow-left"></i><span>Quản lý</span><i
                                class="ri-arrow-right-s-line iq-arrow-right"></i></a>
                        <ul id="dashboard" class="iq-submenu collapse show" data-parent="#iq-sidebar-toggle">

                            <li class="active"><a href="/home"><i class="las la-laptop-code"></i>Tổng Quan</a>

                            </li>

                        </ul>
                    </li>
                    <li>
                        <a href="#userinfo" class="iq-waves-effect" data-toggle="collapse" aria-expanded="false"><span
                                class="ripple rippleEffect"></span><i
                                class="las la-user-tie iq-arrow-left"></i><span>Khách hàng</span><i
                                class="ri-arrow-right-s-line iq-arrow-right"></i></a>

                        <ul id="userinfo" class="iq-submenu collapse" data-parent="#iq-sidebar-toggle">
                            <li><a href="/customer"><i class="las la-th-list"></i>Khách hàng</a>
                            </li>
                            <li><a href="/supplier"><i class="ri-database-line"></i>Nhà cung cấp</a></li>

                        </ul>
                    </li>
                    <li>
                        <a href="#tables" class="iq-waves-effect collapsed" data-toggle="collapse"
                           aria-expanded="false"><i
                                class="ri-table-line iq-arrow-left"></i><span>Quản Lí</span><i
                                class="ri-arrow-right-s-line iq-arrow-right"></i></a>
                        <ul id="tables" class="iq-submenu collapse" data-parent="#iq-sidebar-toggle">

                            <li><a href="tables-basic.html"><i class="ri-table-line"></i>Kho Hàng</a></li>
                            <li><a href="data-table.html"><i class="ri-database-line"></i>Hàng Hóa</a></li>
                            <li><a href="data-table.html"><i class="ri-database-line"></i>Xuất Hàng</a></li>

                            <li><a href="/purchase"><i class="ri-database-line"></i>Nhập Hàng</a></li>
                        </ul>
                    </li>

                    <li>
                        <a href="#forms" class="iq-waves-effect collapsed" data-toggle="collapse" aria-expanded="false"><i
                                class="lab la-wpforms iq-arrow-left"></i><span>Tiền Bạc</span><i
                                class="ri-arrow-right-s-line iq-arrow-right"></i></a>
                        <ul id="forms" class="iq-submenu collapse" data-parent="#iq-sidebar-toggle">
                            <li><a href="form-layout.html"><i class="las la-book"></i>Thu</a></li>
                            <li><a href="form-validation.html"><i class="las la-edit"></i>Chi</a></li>
                        </ul>
                    </li>

                    <li>
                        <a href="#charts" class="iq-waves-effect collapsed" data-toggle="collapse"
                           aria-expanded="false"><i
                                class="ri-pie-chart-box-line iq-arrow-left"></i><span>Đặt hàng</span><i
                                class="ri-arrow-right-s-line iq-arrow-right"></i></a>
                        <ul id="charts" class="iq-submenu collapse" data-parent="#iq-sidebar-toggle">
                            <li><a href="/customer_order"><i class="ri-folder-chart-2-line"></i>Khách Hàng</a></li>
                            <li><a href="chart-apex.html"><i class="ri-folder-chart-2-line"></i>Nhà Cung Cấp</a></li>
                        </ul>
                    </li>

                </ul>
            </nav>
            <div class="p-3"></div>
        </div>
    </div>
    <!-- TOP Nav Bar -->
    <div class="iq-top-navbar">
        <div class="iq-navbar-custom">
            <nav class="navbar navbar-expand-lg navbar-light p-0 mt-3">

                <div class="iq-search-bar d-flex">
                    <a href="/customer_order/">
                        <i class="fas fa-arrow-left font-size-20 mt-2 mr-2 "></i>
                    </a>
                    <h4 class="ml-1 font-size-24">Đặt hàng bún</h4>
                </div>
                <button class="navbar-toggler" type="button" data-toggle="collapse"
                        data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                        aria-label="Toggle navigation">
                    <i class="ri-menu-3-line"></i>
                </button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav ml-auto navbar-list">

                        <li class="nav-item nav-icon mr-2">
                            <button class="btn btn-outline-primary">Lưu & Tiếp tục</button>
                        </li>

                        <li class="nav-item nav-icon">
                            <button class="btn btn-outline-warning" data-target="modalCreateOrderCustomer"
                                    id="btnCreate">Xác nhận
                            </button>

                        </li>
                    </ul>
                </div>

            </nav>
        </div>
    </div>
    <!-- TOP Nav Bar END -->

    <!-- Page Content  -->
    <div id="modalCreateOrderCustomer" class="content-page">
        <div class="container-fluid">
            <div class="row">
                <div class="col-sm-6">
                    <div style="width: 100% ; height: 100% ; background-color: rgb(240, 240, 240); border-radius: 3px;"
                         class="">
                        <div class="iq-card mt-4">
                            <div class="iq-card-body">
                                <table id="tbItemCustomer" class="table">
                                    <thead class="bg-primary">
                                    <tr class="text-center">
                                        <th scope="col">Số lượng (Kg)</th>
                                        <th scope="col">Giá (đ)</th>
                                        <th scope="col">Thành tiền (đ)</th>
                                    </tr>
                                    </thead>
                                    <tbody>

                                    </tbody>
                                </table>
                                <div class="p-2 row">
                                    <div style="text-align: end" class="col-sm-6 ">
                                        <div class="">
                                            <label for="">Thanh toán</label>
                                        </div>
                                        <div class="">
                                            <label for="">Khách đưa</label>
                                        </div>
                                        <hr>
                                        <div class="">
                                            <label for="">Còn lại</label>
                                        </div>
                                    </div>
                                    <div style="text-align: center" class="col-sm-6">
                                        <div>
                                            <input disabled class="text-center" id="totalAmount"/>
                                        </div>
                                        <div>
                                            <input class="text-center" id="inputPriceCustomer" type="number"
                                                   value="0đ"/>
                                        </div>
                                        <hr>
                                        <div>
                                            <input disabled class="text-center" id="remainingAmount" type="number"
                                                   value="0đ"/>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                <div class="col-sm-6">
                    <div style="width: 100%; border: gray 1px solid; border-radius: 5px;">
                        <div class="text-center font-weight-bold ">
                            <div>
                                <a style="height: 100%" class="font-size-24" lass="btn btn-primary"
                                   data-toggle="collapse" href="#infoOrder" role="button"
                                   aria-expanded="false" aria-controls="collapseExample">Thông tin đơn
                                    hàng</a>
                            </div>
                            <hr style=" background: gray;height: 1px;">
                            <div style=" height: 355px ;" class=" collapse" id="infoOrder">
                                <div>
                                    <div style="position:relative; height: 50px;  background-color: #f1f1f1;"
                                         class="card card-body  ">
                                        <span class="font-size-18">sinh</span>
                                    </div>
                                </div>
                                <div class=" mt-2">
                                    <div style="position:relative; height: 50px; background-color: #f1f1f1;"
                                         class="card card-body  ">
                                        <h5 style="top:2px; position: absolute;" class="font-size-14">Ngày đặt hàng
                                        </h5>
                                        <span class="font-size-18">23/02/2022</span>
                                    </div>
                                </div>
                                <div class="  mt-2">
                                    <div style="position:relative; height: 50px; background-color: #f1f1f1;"
                                         class="card card-body  ">
                                        <h5 style="top:2px; position: absolute;" class="font-size-14">Dự kiến giao
                                        </h5>
                                        <span class="font-size-18">23/02/2022</span>
                                    </div>
                                </div>
                                <div class=" collapse  mt-2" id="collapseExample">
                                    <div style="position:relative; height: 90px;  background-color: #f1f1f1;"
                                         class="card card-body  ">
                                        <h5 style="top:2px; position: absolute;" class="font-size-14">Ghi chú </h5>
                                        <span class="font-size-18">
                                            <textarea style="height:59px;
                                                      width:540px"
                                                      class=" form-control"
                                                      name="" id=""
                                                      cols="20"
                                                      rows="10">

                                            </textarea>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-4" style="max-width: 100% ; border-top: gray 1px solid; border-radius: 5px;">
                        <div class="font-weight-bold">
                            <div class="text-center">
                                <div class="col-12">
                                    <h3>Khách hàng</h3>
                                </div>
                                <div class="row">
                                    <div class="col-6">
                                        <input id="completeUser" class="btn-sm"
                                               placeholder="Nhập tên hoặc số điện thoại khách hàng"/>
                                        <div class="show--list hide"></div>
                                    </div>
                                    <div class="col-6 plus">
                                        <a data-toggle="collapse"
                                           href="#cus" role="button" aria-expanded="false"
                                           aria-controls="collapseExample" class="mr-3">
                                            <i role="button" class="fas fa-plus"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>

                            <hr style="background: gray; height: 1px;">

                            <div id="cus" style=" height: 355px; float: left ; background-color: white;"
                                 class="collapse ml-4 ">
                                <form id="frmCreateCus">
                                    <div class="form-row text-center">


                                        <div class="form-group col-sm-8 ">
                                            <label for="nameCus">Tên Khách Hàng</label>
                                            <input type="text" class="form-control" name="nameCus" id="nameCus"
                                                   placeholder="Nguyễn Văn A">
                                        </div>
                                        <div class="form-group col-sm-8 ">
                                            <label for="emailCus">Email</label>
                                            <input type="text" class="form-control" name="emailCus" id="emailCus"
                                                   placeholder="24 Nguyễn Tri Phương">
                                        </div>
                                        <div class="form-group col-sm-8 ">
                                            <label for="phoneCus">Điện Thoại</label>
                                            <input type="tel" class="form-control" name="phoneCus" id="phoneCus"
                                                   placeholder="0123456789">
                                        </div>


                                    </div>
                                </form>
                            </div>
                            <div style=" height: 355px; float: left ; background-color: #f1f1f1;"
                                 class="collapse ml-4">
                                <div class="card" style="width: 9rem">
                                    <img style="height:150px"
                                         src="https://i.pinimg.com/736x/6e/6e/5b/6e6e5b918b0b14073bad156534fc54da.jpg"
                                         class="card-img-top" alt="...">
                                    <div style="  padding-top:3px; position: relative;" class=" ">
                                        <h5 class="card-title">Nguyễn Thị Lisa</h5>
                                        <p style="position: absolute; top :27px ; left: 44px;" class="card-text">28
                                            Thái Lan</p>
                                        <p style="position: absolute; top :55px ; left: 44px;" class="card-text">
                                            0987654321</p>
                                        <a href="#" class="btn btn-primary mt-5 mb-1">Thêm</a>
                                    </div>
                                </div>
                            </div>


                            <div style=" height: 355px;  float: left" class="collapse ml-4" id="customers">
                                <div class="card" style="width: 9rem;">
                                    <img style="height:150px"
                                         src="https://i.pinimg.com/736x/6e/6e/5b/6e6e5b918b0b14073bad156534fc54da.jpg"
                                         class="card-img-top" alt="...">
                                    <div style="  padding-top:3px; position: relative;" class=" ">
                                        <h5 class="card-title">Nguyễn Thị Lisa</h5>
                                        <p style="position: absolute; top :27px ; left: 44px;" class="card-text">28
                                            Thái Lan</p>
                                        <p style="position: absolute; top :55px ; left: 44px;" class="card-text">
                                            0987654321</p>
                                        <a href="#" class="btn btn-primary mt-5 mb-1">Thêm</a>
                                    </div>
                                </div>
                            </div>
                            <div style=" height: 355px;  float: left" class="collapse ml-4 " id="customer">
                                <div class="card" style="width: 9rem;">
                                    <img style="height:150px"
                                         src="https://i.pinimg.com/736x/6e/6e/5b/6e6e5b918b0b14073bad156534fc54da.jpg"
                                         class="card-img-top" alt="...">
                                    <div style="  padding-top:3px; position: relative;" class=" ">
                                        <h5 class="card-title">Nguyễn Thị Lisa</h5>
                                        <p style="position: absolute; top :27px ; left: 44px;" class="card-text">28
                                            Thái Lan</p>
                                        <p style="position: absolute; top :55px ; left: 44px;" class="card-text">
                                            0987654321</p>
                                        <a href="#" class="btn btn-primary mt-5 mb-1">Thêm</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

        </div>
    </div>
    <!-- Wrapper END -->
    <!-- Footer -->
    <footer class="iq-footer">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-6">
                    <ul class="list-inline mb-0">
                        <li class="list-inline-item"><a href="privacy-policy.html">Privacy Policy</a></li>
                        <li class="list-inline-item"><a href="terms-of-service.html">Terms of Use</a></li>
                    </ul>
                </div>
                <div class="col-lg-6 text-right">
                    Copyright 2020 <a href="#">FinDash</a> All Rights Reserved.
                </div>
            </div>
        </div>
    </footer>
    <!-- Footer END -->

    <!-- Modal- đặt hàng -->
    <div class="modal fade" id="createCustomer" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog mw-100 w-50">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Tạo Khách Hàng</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="row">
                            <div class="form-group col-md-8">
                                <label for="fullName">Tên khách hàng</label>
                                <input type="name" class="form-control" id="fullName" placeholder="Nguyễn Văn A">
                            </div>
                            <div class="form-group col-md-8">
                                <label for="phone">Số điện thoại</label>
                                <input type="phone" class="form-control" id="phone">
                            </div>

                            <div class="form-group col-md-8">
                                <label for="address">Địa chỉ</label>
                                <input type="text" class="form-control" id="address"/>
                            </div>
                        </div>

                    </form>
                </div>
            </div>
        </div>
    </div>

    <th:block th:replace="/layout/script/footer :: footer"/>

</div>

<script>
    let item = new Item();
    let product = new Product();
    let user = new User();
    let order = new Order();
    let orderItem = new OrderItem();


    function renderCartItem(obj) {
        console.log("obj ", obj)
        let str = `
             <tr class="text-center" id="tr_${obj.id}">
                    <td style="width: 150px;margin: 40px auto;">
                        <div class="input-group text-center">
                            <span class="input-group-btn">
                                        <button type="button"
                                                onclick="handleReduceQuantity()"
                                                class="btn btn-info btn-number item-quantity"
                                                title="Giảm số lượng bún"
                                                data-type="plus" data-field="quant[2]">
                                             <span class="fa fa-minus"></span>
                                        </button>
                            </span>
                            <input style="height: 35px; border-radius: 5px;" type="text"
                                   name="quant[2]" class="form-control"
                                   onclick="handleInputQuantity()"
                                   id ="inputQuantity" value="0" min="0"
                                   max="500">

                            <span class="">
                                        <button type="button"
                                        onclick="handleIncreaseQuantity()"
                                        id="tangsoluong"
                                                class="btn btn-primary btn-number item-quantity counter-up"
                                                title="Tăng số lượng bún"
                                                data-type="minus" data-field="quant[2]">
                                           <span class="fa fa-plus"></span>
                                        </button>
                                    </span>
                        </div>
                    </td>
                    <td>
                        <input class="text-center" id="price" name="price"
                        value="${product.price}"
                        />

                    </td>
                    <td>
                        <input disabled class="form-control-sm-2" id="itemTotalAmount" type="text" value="0">
                    </td>
                </tr>`
        return str;
    }


    function getProductById() {
        $.ajax({
            headers: {
                "accept": "application/json",
                "content-type": "application/json"
            },
            type: "GET",
            url: "http://localhost:8080/api/products/1"
        })
            .done((data) => {
                product = data;
                console.log("product ",product)
                let str = renderCartItem(data)

                $("#tbItemCustomer tbody").prepend(str);
            })
            .fail((jqXHR) => {
                console.log(jqXHR)
            })
    }
    getProductById();

    let btnCreate = $("#btnCreate");
    btnCreate.on('click', () => {
        doCreateOrderCustomer();
    });

    function doCreateOrderCustomer() {
        let newOrder = {
            "id": 0,
            "userId": userId,
            "fullName": $("#fullName").val(),
            "address": $("#address").val(),
            "phone": $("#phone").val(),
            "orderItems": [{
                "quantity": $("#inputQuantity").val(),
                "productId": 1
            }]
        }
        $.ajax({
            headers: {
                accept: "application/json",
                "content-type": "application/json"
            },
            type: "POST",
            url: "http://localhost:8080/api/orders/create",
            data: JSON.stringify(newOrder)
        })
            .done((data) => {
                order = data;
                console.log("data = ", data)
            })
            .fail((jqXHR) => {
                alert("id ko tim thay")
                console.log(jqXHR);
            })
    }

    function handleIncreaseQuantity() {

        let quantity = +$("#inputQuantity").val();
        quantity += 5;
        $("#inputQuantity").val(quantity)

        let price = +$("#price").val();

        let totalAmount = quantity * price;
        $("#itemTotalAmount").val(totalAmount)
        $("#totalAmount").val(totalAmount)
    }

    function handleReduceQuantity() {

        let quantity = +$("#inputQuantity").val();
        quantity -= 5;
        $("#inputQuantity").val(quantity)

        let price = +$("#price").val();

        let totalAmount = quantity * price;
        $("#itemTotalAmount").val(totalAmount)
        $("#totalAmount").val(totalAmount)
    }

    function getAllOrderItem() {
        $.ajax({
            headers: {
                "accept": "application/json",
                "content-type": "application/json"
            },
            type: "GET",
            url: "http://localhost:8080/api/order-items"
        })
            .done((data) => {
                orderItem = data;

            })
            .fail((jqXHR) => {
                console.log(jqXHR)
            })
    }

    getAllOrderItem();


    function handleInputQuantity() {
        $("#inputQuantity").on('input', () =>{
            let quantity = +$("#inputQuantity").val();
            $("#inputQuantity").val(quantity)
            let price = +$("#price").val();
            let totalAmount = quantity * price;
            $("#itemTotalAmount").val(totalAmount);

            $("#totalAmount").val(totalAmount);
        })
    }

    function getUserById(userId) {
        return (
            $.ajax({
                headers: {
                    "Accept": 'application/json',
                    "Content-type": 'application'
                },
                type: "GET",
                url: "http://localhost:8080/api/users/" + userId,
            }).done((data) => {
                user = data;

            }).fail((jxHQR) => {
                console.log(jxHQR)
            })
        )
    }

    function handleInputPriceCustomer() {
        $("#inputPriceCustomer").on("input", function () {
            let quantity = +$("#inputQuantity").val();
            let price = +$("#price").val();
            let totalAmount = quantity * price;
            let remainingAmount = totalAmount - (+$("#inputPriceCustomer").val());
            $("#remainingAmount").val(remainingAmount);
        })
    }

    handleInputPriceCustomer();

    $('#completeUser').on('input', function () {
        let keyword = $('#completeUser').val();
        console.log("keyword", keyword)
        search(keyword);
    })
    let userId = 0;

    function onclickUser(id) {
        userId = id;
    }

    function search(keyword) {
        $.ajax({
            header: {
                "accept": "application/json",
                "content-type": "application/json"
            },
            type: "GET",
            url: "http://localhost:8080/api/users/search/" + keyword,
        })
            .done((data) => {
                let str = "";
                $.each(data, (i, item) => {
                    user = item;
                    str += `<p onclick="onclickUser(${item.id})">${user.fullName} - ${user.phone}</p>`;
                })
                $('.show--list').html(str);
                // console.log(str);
                $('.show--list').removeClass("hide").addClass("show");

            })
            .fail((jqXHR) => {
                console.log(jqXHR)

            })
    }


</script>
</body>

</html>